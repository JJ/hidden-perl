<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Ephemeral miniconf: Native Github actions in Perl</title>

    <link rel="stylesheet" href="dist/reset.css">
    <link rel="stylesheet" href="dist/extra.css">
    <link rel="stylesheet" href="dist/reveal.css">
    <link rel="stylesheet" href="dist/hidden-perl.css" id="theme">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
	<section data-background='https://live.staticflickr.com/619/20996949839_9be1423b2c_k_d.jpg'>
          <h1>Native GitHub actions in Perl</h1>
          <h2>Ephemeral mini-conf, 2021</h1>
          <h3><code> <a href='https://twitter.com/jjmerelo'>@jjmerelo</code> ⋄
	    <code><a
	      href='https://github.com/JJ'>github.com/JJ</code> ⋄
	      <code><a
		href='https://metacpan.org/author/JMERELO'>CPAN:
		    JMERELO</a></code>
                  <aside class='notes'>CPAN being the Comprehensive
                    Perl Archive Network</aside>
              </section>

	      <section data-background='https://live.staticflickr.com/3507/3791689000_76e3a5ef16_k_d.jpg' ><h1>Programming Perl since 1993</h1>
                <h2>Lately more Raku (previously known as Perl 6)</h2>
                <aside class='notes'>Picture taken in 2009, Perl
                    conference in Lisbon</aside>
              </section>

              <section data-background='https://live.staticflickr.com/65535/50856984756_4cfa5e7883_k_d.jpg'>
                  <h2>Continuous integration tools run in
                      containers</h2>
                  <h1 class='fragment'>Do they contain Perl?</h1>
                  <h1 class='fragment'>Yes they do!</h1>
              </section>

              <section><h1>Hello from a GitHub action</h1>
                  <pre><code data-line-numbers="1|1,2|3|3-5|6|7|8|9-10|7-11">name: Hello Perl
on: [push, pull_request]
jobs:
  hello-perl:
    runs-on: ubuntu-latest
    steps:
      - name: Hello Perl
        shell: perl {0}
        env:
          ACTION: ${{ github.action }}
        run: print "Hey $ENV{'GITHUB_ACTOR'} from $ENV{'ACTION'}";
                  </code></pre>
              </section>

              <section data-background="img/perl-shell-github.png"><h1 class="fragment">Widely
                  unknown...</h1>
                  <h2 class="fragment">But still useful</h2>
              </section>

              <section data-background=""><h1>With lots of goodies</h1>
                  <pre><code data-background="3-5|8">    steps:
      - name: Checkout
        uses: actions/checkout@v2
        with:
          fetch-depth: 2
      - name: Ref issue present in a commit
        shell: perl {0}
        run: use Git; exit(1) if Git->repository->command("log", "--oneline", "-1") !~ /\#/;
                  </code></pre>
                  <aside class="notes">First, we use an external action; this is
                  one of the nice things with GHA, these pre-made steps you can
                  re-use, even if they are so mundane as just checking out the
                  source. This library is preinstalled when you
                  install git, which of course is installed everywhere. Still, a
                      nit: we simply exit without precisely telling what's the
                      deal</aside>
              </section>

              <section><h1 class="fragment">It's not pretty</h1>
                  <img src="img/exit-error.png" alt="error when failed">
                  <h2 class="fragment">... But it does its job</h2>
              </section>

              <section><h1>Use <a href="https://gist.github.com/JJ/edf3a39d68525439978da2a02763d42b"> installed modules</a></h1>
                  <pre><code>          use Perl::OSType qw(os_type);
          use Time::HiRes qw(tv_interval);
          my $t0 = [gettimeofday];
          print "Hey $ENV{'GITHUB_ACTOR'} from $ENV{'GITHUB_ACTION'} running on ",
              os_type(), " for ", tv_interval ( $t0 );</code></pre>

          <aside class="notes">There are lots of goodies installed, including
              these ones below...  </aside>
              </section>

              <section><h1>Installed modules related to</h1>
                  <h2>Test, including <code>prove</code></h2>
                  <h2>CGI (???)</h2>
                  <h2>Packaging, Debian</h2>
                  <h2>CPAN</h2>
                  <h2>IO utils...</h2>

                  <aside class="notes">But Github action goes beyond what we can
                      find in their runners. There's a way of communicating stuff to them.</aside>
              </section>

              <section><h1>Use the API, papi</h1>
                  <pre><code data-line-numbers="2|1-3">          use Git; # Rest of GHA the same
          die "::error::Last commit should refer to an issue"
              if ( Git->repository->command("log", "--oneline", "-1") !~ /\#/ );
                  </code></pre>

                  <aside class="notes">Curiously enough, the API is a series of
                      files to which you can print as well as specially formatted
                      messages printed to STDOUT. These will be picked up by the runner
                      and displayed as "Annotations".</aside>
              </section>

              <section>
                  <h1>Or use <code>GitHub::Actions</code></h1>
                  <pre><code data-line-numbers="4,5|8-10">    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Install GitHub::Actions
        run: sudo cpan GitHub::Actions
      - name: Ref issue present in a commit
        shell: perl {0}
        if: ${{! contains(github.event.head_commit.message, '#') }}
        run: |
          use GitHub::Actions;
          set_failed( "Last commit should refer to an issue" );
                  </code></pre>              </section>

              <section><h1>Installing the whole wide CPAN</h1>
                  <img src="img/sudo-cpan.png" alt="Installing stuff">
              </section>
              
              <section
                  data-background='https://live.staticflickr.com/6011/5985488687_d361aefa26_k_d.jpg'><h2>Perl
                  is</h2>
                  <h1 class='fragment'>no longer</h1>
          <h2>the hidden gem of test/deployment automation</h2>

          <aside class='notes'>If only because we have tried really
            hard to reveal it, exploring and finding where it was
            installed and what kind of stuff was available.</aside>
        </section>

        <section data-background='https://live.staticflickr.com/4028/4287623525_8554be0345_o_d.jpg'><h2>Unlike <code>bash</code>, a real language</h2>
          <h1 class='fragment'>Like <code>bash</code>, always <em>there</em></h1>
          <h3 class='fragment'>Packaged modules, bundleable scripts</h3>
        </section>

        <section
        data-background='https://live.staticflickr.com/65535/50858905741_1276dd983c_k_d.jpg'><h1>Use
            Perl in your next CI workflows!</h1>
            <h2 class="fragment">No (other) containers needed!</h2>
            <h1 class="fragment">Thanks!</h1>
            <aside class="notes">This is a picture of Wendy's stand in
        the many perl conferences, which we sadly miss now. Let's hope
                it comes back soon, along with presential conferences!</aside>
        </section>

      </div>
	  </div>

	  <script src="dist/reveal.js"></script>
	  <script src="plugin/notes/notes.js"></script>
	  <script src="plugin/markdown/markdown.js"></script>
	  <script src="plugin/highlight/highlight.js"></script>
	  <script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
			  hash: true,
                          width: '98%',
                          controls: true,
                          progress: true,
                          history: true,
                          autoPlayMedia: true,
				// Learn about plugins: https://revealjs.com/plugins/
			  plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
